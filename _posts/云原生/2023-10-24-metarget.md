---
categories: [容器]
tags: metarget 云原生 Docker K8s
---
# 2023.10.24
参考视频：[Metarget:构建云原生基础设施靶场](https://www.bilibili.com/video/av548776437/?vd_source=6671d33bcf63c21d36edfa9a8e5b473e)

参考链接：[Metarget:云原生攻防靶场](https://github.com/Metarget/metarget/blob/master/README-zh.md)
## 0x01 攻击者视角的云原生安全
### 1.1 容器技术风险
![2023-10-24-11-14-51.png](https://s2.loli.net/2023/10/27/CsBhqbzgtLo1Vyw.png)
### 1.2 针对k8s的六种攻击类型
![2023-10-24-11-16-06.png](https://s2.loli.net/2023/10/27/bjyl3ODNKHnLV2Q.png)
### 1.3 针对K8s的一般渗透过程
![2023-10-24-11-19-39.png](https://s2.loli.net/2023/10/27/MOnbEmIa6fsDzgL.png)
##  0x02 Metarget介绍
### 2.1 案例：
最近在研究metarget云原生安全靶场，找到一个Bonan RUAN在一次大会上做的demo，于是想要跟着一起试一下。这个环境需要两台ubuntu机器，由于我的本机是arm64架构，运行metarget会出现这样那样的问题，于是就申请了一台内网windows虚拟机，想要尝试在其中搭建所需要的环境。

最开始安装vmware安装成了最普通的版本，导致虚拟机与宿主机的端口映射无法进行，于是又重新下载了pro版本，听1+说可以在网上直接找密钥（不敢相信我是第一次知道），就激活了pro版，现在正在重新搭建环境ing。

现在大致列了一个思路：

查看虚拟机ip -> 编辑虚拟机网络设置，进行宿主机端口转发 -> 虚拟机更新镜像源 -> apt-get update -> 配置ssh -> 更改虚拟机上ssh默认端口 -> 更改防火墙相关设置 -> 测试使用

在进行“虚拟机更新镜像源”这一步之前，我突然想，能否直接给虚拟机的apt像git一样设置代理？

请看: [Post:配置apt-get使用socks5代理]({% post_url 2023-10-30-apt-get使用socks5代理 %})

### 2.2 环境搭建
参考链接：
1. [windows宿主机如何SSH连接VMware的Linux虚拟机](https://cloud.tencent.com/developer/article/1679861)
2. [windows宿主机ssh连接vmware ubuntu虚拟机](https://bbs.huaweicloud.com/blogs/348910)
3. [修改ssh默认端口](https://cloud.tencent.com/developer/article/1635355)
4. [设置代理解决github被墙](https://zhuanlan.zhihu.com/p/481574024)
#### 2.2.1 查看虚拟机ip
![2023-10-30-11-20-02.png](https://s2.loli.net/2023/10/30/Wcws596d4Fhx37l.png)
#### 2.2.2 宿主机端口转发
1. 关闭所有虚拟机
2. VMWare Workstation -> 编辑 -> 虚拟机网络编辑器 -> 更改设置 -> NAT设置 -> 添加 -> 确定 -> 应用 -> 确定
   ![2023-10-30-11-21-51.png](https://s2.loli.net/2023/10/30/ExKy1dPMFfAbm6L.png)
   ![2023-10-30-11-22-35.png](https://s2.loli.net/2023/10/30/cS1AVmNMLDgHYxr.png)
   ![2023-10-30-11-23-27.png](https://s2.loli.net/2023/10/30/E9l7Zk5uHYAwN6Q.png)
#### 2.2.3 ubuntu设置apt-get使用socks5代理
同上文设置
#### 2.2.4 配置ssh
1. 安装`openssh-client`:`sudo apt-get install openssh-client`
2. 安装`openssh-server`:`sudo apt-get install openssh-server`
3. 启动`ssh-server`:`sudo /etc/init.d/ssh restart`
4. 确认`ssh-server工作正常`:`netstat -tpl （看到ssh表示工作正常）`
   ![2023-10-30-11-33-59.png](https://s2.loli.net/2023/10/30/wG1J7OjDEna5r9u.png)
#### 2.2.5 更改虚拟机上ssh默认端口
为了以防万一，22端口和10122端口均开启。
![2023-10-30-11-54-01.png](https://s2.loli.net/2023/10/30/hofHxTdt5cq28yG.png)
#### 2.2.6 更改防火墙设置，开启端口
![2023-10-30-11-54-50.png](https://s2.loli.net/2023/10/30/tjGVlNzZSsg6CMT.png)
#### 2.2.7 windows虚拟机防火墙新建入站规则
防火墙 -> 高级设置 -> 入站规则 -> 新建规则 -> 规则类型(端口) -> 协议和端口(特定本地端口) -> 允许连接
#### 2.2.8 测试连接
![2023-10-30-11-52-09.png](https://s2.loli.net/2023/10/30/VIYj9sHbQB4KqAa.png)